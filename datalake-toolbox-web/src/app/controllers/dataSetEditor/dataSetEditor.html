<div ui-view>
  <navbar/>
</div>

<div class="container-fluid sg-page-container" style="padding-top:20px;">

  <div class="row">

    <div class="col-sm-3">

      <div class="form-group sg-buttons">
        <a type="button" class="btn btn-primary" aria-label="Left Align" ui-sref="view" style="margin-right:10px;">
          <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> Back
        </a>
        <a type="button" class="btn btn-success" ui-sref="chooseTable">
          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add new table
        </a>
      </div>

      <div class="panel panel-default" ng-if="!datasetEditor.tables.length">
        <div class="panel-heading" ><i>No table</i>
        </div>
        <div class="panel-body">
          <p><i>No table selected. Please click on the "Add new table" button to add tables.</i></p>
        </div>
      </div>

      <div class="panel panel-default" ng-if="datasetEditor.tables.length">
        <div class="panel-heading" > <span class="glyphicon glyphicon-flash"></span> Calculated columns
        </div>
        <div class="panel-body">
          <p ng-if="!datasetEditor.calculatedColumns.length"><i>No calculated columns.</i></p>
          <div ng-repeat="c in datasetEditor.calculatedColumns" class="checkbox">
            <label>
              <input type="checkbox" checked="checked" ng-click="datasetEditor.removeCalculatedColumn($event, c)"><span>{{c.newName}}</span>
              <br/>
              <span><i>{{c.newDescription}}</i></span>
            </label>
          </div>
        </div>
      </div>

      <div class="panel panel-default" ng-repeat="table in datasetEditor.tables">
        <div class="panel-heading" > <span class="glyphicon glyphicon-th-large"></span> {{table.database}}.{{table.table}}
          <span ng-if="table.primary" class="pull-right"> <b><span class="glyphicon glyphicon-star" aria-hidden="true"></span> Primary</b></span>
        </div>
        <div class="panel-body">
            <button type="button" class="btn btn-danger btn-xs pull-right"  ng-click="datasetEditor.removeTable(table)">
            <span class="glyphicon glyphicon-minus" aria-hidden="true"></span> Remove
          </button>
          <button type="button" class="btn btn-info btn-xs" ng-click="datasetEditor.links(table)">
            <span class="glyphicon glyphicon-link" aria-hidden="true"></span> Links
          </button>
          <button type="button" class="btn btn-info btn-xs">
            <span class="glyphicon glyphicon-signal" aria-hidden="true"></span> Refresh statistics
          </button>
          <button type="button" class="btn btn-info btn-xs" ng-if="!table.primary" ng-click="datasetEditor.makeTablePrimary(table.database, table.table)">
            <span class="glyphicon glyphicon-star" aria-hidden="true"></span> Make principal
          </button>
        </div>
        <div class="panel-body" style="max-height:300px; overflow-y: scroll;">
          <div ng-repeat="c in table.columns" class="checkbox">
            <label>
              <input type="checkbox" ng-model="c.selected" ng-change="datasetEditor.onColumnSelectionChange(c)">
              <span ng-if="c.name.localeCompare(c.newName)"><del>{{c.name}}</del>&nbsp;&nbsp; </span>
              <span>{{c.newName}}</span>
              <br/>
              <span><i>{{c.newDescription}}</i></span>
            </label>
          </div>
        </div>
      </div>


    </div>

    <div class="col-sm-9">

      <div class="form-group sg-buttons fill-height-substract" style="height:34px;"> <!-- fix height because pull-right doesn't allow to auto-calculate -->
        <a type="button" class="btn btn-primary pull-right" ng-click="datasetEditor.save()">
          <span class="glyphicon glyphicon-save"></span> Save
        </a>
      </div>

      <div class="row fill-height-substract">

        <div class="col-sm-12">
          <uib-tabset active="datasetEditor.activeTab">
            <uib-tab index="0" heading="DataSet">

              <div class="panel panel-default panel-editor-tab" style="height: 220px;">
                <div class="panel-body">

                  <fieldset>
                    <form style="padding: 0px;">


                      <div class="row">
                        <div class="col-sm-4">
                          <div class="form-group">
                            <label for="inputDatasetName" class="control-label">DataSet Name</label>
                            <input class="form-control" id="inputDatasetName" placeholder="" ng-model="datasetEditor.name">
                          </div>
                        </div>

                        <div class="col-sm-4">
                          <div class="form-group">
                            <label for="inputDatasetDescription" class="control-label">DataSet Description</label>
                            <input class="form-control" id="inputDatasetDescription" placeholder="" ng-model="datasetEditor.description">
                          </div>
                        </div>

                      </div>

                      <div class="row">
                        <div class="col-sm-8">
                          <div class="form-group">
                            <div class="checkbox">
                              <label>
                                <input type="checkbox" value="">
                                Persistent DataSet
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>


                    </form>
                  </fieldset>

                </div>
              </div>

            </uib-tab>

            <uib-tab index="1" heading="Filter">

              <div class="panel panel-default panel-editor-tab" style="min-height: 220px;">
                <div class="panel-body">

                  <div style="margin-bottom:10px;">
                    <pre ng-bind-html="datasetEditor.computedGroup()"></pre>
                  </div>

                  <query-builder group="datasetEditor.queryGroup" fields="datasetEditor.queryFields"></query-builder>

                </div>
              </div>

            </uib-tab>

            <uib-tab index="2" heading="Column manipulation">

              <div class="panel panel-default panel-editor-tab" style="height: 220px;">
                <div class="panel-body">

                  <fieldset ng-disabled="!datasetEditor.selectedColumn">
                    <form style="padding: 0px;"  ng-submit="datasetEditor.rename()">


                      <div class="row">
                        <div class="col-sm-4">
                          <div class="form-group">
                            <label for="inputColumnName" class="control-label">Name</label>
                            <input class="form-control" id="inputColumnName" placeholder="" ng-model="datasetEditor.renameField">
                          </div>
                        </div>

                        <div class="col-sm-4">
                          <div class="form-group">
                            <label for="inputColumnType" class="control-label">Type</label>
                            <select class="form-control" id="inputColumnType" style="font-family: FontAwesome, sans-serif;" ng-model="datasetEditor.changeType">
                              <option value="">Keep Original</option>
                              <option value="Numeric Integer">123 - Numeric Integer</option>
                              <option value="Numeric Float">1.23 - Numeric Float</option>
                              <option value="String">abc - String</option>
                              <option value="Date">&#xf133; - Date</option>
                              <option value="Date and Time">&#xf017; - Date and Time</option>
                              <option value="Boolean">&#xf046; - Boolean</option>
                            </select>
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-sm-8">
                          <div class="form-group">
                            <label for="inputColumnDescription" class="control-label">Description</label>
                            <input class="form-control" id="inputColumnDescription" placeholder="" ng-model="datasetEditor.renameDescription">
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-sm-4">
                          <div class="form-group">
                            <button type="submit" class="btn btn-default">Apply</button>
                          </div>
                        </div>
                      </div>

                    </form>
                  </fieldset>

                </div>
              </div>

            </uib-tab>

            <uib-tab index="3">
              <uib-tab-heading>
                Calculated column
              </uib-tab-heading>

              <div class="panel panel-default panel-editor-tab" style="height: 220px;">
                <div class="panel-body">

                  <fieldset ng-disabled="!datasetEditor.selectedColumn">

                    <form>

                      <div class="row">
                        <div class="col-sm-8">
                          <div class="form-group">
                            <button type="button" class="btn btn-info"  ng-click="datasetEditor.createCalculated()" ng-disabled="datasetEditor.selectedColumnIsCalculated">
                              <span class="glyphicon glyphicon-duplicate" aria-hidden="true"></span> Create calculated
                            </button>
                            <span style="margin-left:10px;"><i><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF" target="_blank">Help on fonctions</a></i></span>
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-sm-12">
                          <div class="form-group">
                            <textarea class="form-control" rows="6" ng-model="datasetEditor.selectedColumn.formula" ng-disabled="!datasetEditor.selectedColumnIsCalculated">
                            </textarea>
                          </div>
                        </div>
                      </div>

                    </form>

                  </fieldset>

                </div>
              </div>
            </uib-tab>
          </uib-tabset>
        </div>


      </div>

      <div class="row">

        <div class="col-sm-12">
          <div class="panel panel-default">
            <div class="panel-body" style="padding: 0px 0px">

              <nav class="navbar navbar-default fill-height-substract" style="margin: 0px 10px; border-width: 0px;">
                <form class="navbar-form navbar-right">
                  <button type="button" class="btn btn-default" ng-click="datasetEditor.cancelGetData()" ng-if="datasetEditor.isLoading" style="margin-right:10px;">  <i><span>cancel</span></i></button>
                  <div class="form-group" style="margin-right:10px;" ng-if="datasetEditor.isLoading">
                    <div class="progress" style="margin-bottom:0px;">
                      <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100px;">
                        <span class="sr-only">Loading...</span>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="table-max-row">Max rows :</label>
                    <input ng-model="datasetEditor.maxRows" type="text" class="form-control" id="table-max-row" placeholder="Max rows" value="1000">
                  </div>
                  <button type="button" class="btn btn-default" ng-click="datasetEditor.getData()">  <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
                </form>
              </nav>
              <div style="border-bottom-width: 0px;border-left-width: 0px;border-right-width: 0px;" fill-height="fill-height-substract" ui-grid="datasetEditor.gridOptions" class="gridSample"  ui-grid-resize-columns ui-grid-auto-resize ></div>
            </div>
          </div>
        </div>

      </div>


    </div>
  </div>


  <!-- END : main-container -->


</div>
